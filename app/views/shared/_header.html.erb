<nav class="navbar navbar-expand-md navbar-dark bg-success shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold fs-3" href="/" style="letter-spacing: 2px;">Almora</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      
      <form class="mx-auto w-100" style="max-width: 400px;">
        <div class="input-group">
          <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
          <input type="search" class="form-control border-start-0" placeholder="Search products...">
        </div>
      </form>

     
      <div class="d-flex align-items-center gap-3 ms-auto">
       
        <button class="btn text-white position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" aria-controls="cartOffcanvas">
          <i class="bi bi-cart-fill fs-5"></i>
          <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge bg-danger rounded-pill">
            0
          </span>
        </button>

       
        <a href="/users/sign_in" class="btn btn-outline-light btn-sm rounded-pill px-3">Login</a>
        <a href="/users/sign_up" class="btn btn-light btn-sm text-success rounded-pill px-3">Sign Up</a>
      </div>
    </div>
  </div>
</nav>

<div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas" aria-labelledby="cartOffcanvasLabel">
  <div class="offcanvas-header bg-success text-white">
    <h5 class="offcanvas-title" id="cartOffcanvasLabel">Your Cart</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body bg-white" style="max-height: 80vh; overflow-y: auto;">
    <div id="cart-items-container"></div>
  </div>

  <div class="offcanvas-footer bg-light p-3">
    <div class="d-flex justify-content-between align-items-center">
      <div id="cart-total" class="fw-bold fs-5 text-success mb-0"></div>
      <a href="/checkout" class="btn btn-success px-4">Proceed to Checkout</a>
    </div>
  </div>
</div>



<script>
  function renderCartPage() {
    const container = document.getElementById("cart-items-container");
    const totalDiv = document.getElementById("cart-total");
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");

    if (cart.length === 0) {
      container.innerHTML = "<p class='text-muted'>Your cart is empty.</p>";
      totalDiv.innerHTML = "";
      return;
    }

    let total = 0;

    const html = cart.map((item, index) => {
      const itemTotal = item.unit_price * item.quantity;
      total += itemTotal;

      const optionsHtml = item.variant_options
        ? `<small class="text-muted d-block">${item.variant_options.join("<br>")}</small>`
        : "";

      const imgHtml = item.product_image_url
        ? `<img src="${item.product_image_url}" class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover;">`
        : "";

      return `
        <div class="card mb-3 shadow-sm">
          <div class="card-body d-flex align-items-center gap-3">
            ${imgHtml}
            <div class="flex-grow-1">
              <h6 class="mb-1">${item.product_name}</h6>
              ${optionsHtml}
              <div class="text-muted small">Unit Price: PKR ${item.unit_price}</div>
              <div class="d-flex align-items-center mt-2">
                <button class="btn btn-sm btn-outline-success me-2" onclick="updateQuantity(${index}, -1)">âˆ’</button>
                <span class="mx-2">${item.quantity}</span>
                <button class="btn btn-sm btn-outline-success ms-2" onclick="updateQuantity(${index}, 1)">+</button>
              </div>
            </div>
            <div class="text-end">
              <div class="fw-bold text-success mb-2">PKR ${itemTotal}</div>
              <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})">Remove</button>
            </div>
          </div>
        </div>
      `;
    }).join("");

    container.innerHTML = html;
    totalDiv.innerHTML = `Total: PKR ${total}`;
  }

  function updateQuantity(index, change) {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    cart[index].quantity += change;
    if (cart[index].quantity <= 0) {
      cart.splice(index, 1);
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCountBadge();
    renderCartPage();
  }

  function removeItem(index) {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCountBadge();
    renderCartPage();
  }

  function updateCartCountBadge() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const totalQty = cart.reduce((sum, item) => sum + item.quantity, 0);
    const badge = document.getElementById("cart-badge");
    if (badge) {
      badge.innerText = totalQty;
      badge.style.display = totalQty > 0 ? "inline-block" : "none";
    }
  }

 
  document.addEventListener("DOMContentLoaded", function () {
    updateCartCountBadge();

    document.getElementById("cartOffcanvas")
      .addEventListener("shown.bs.offcanvas", renderCartPage);
  });
</script>
