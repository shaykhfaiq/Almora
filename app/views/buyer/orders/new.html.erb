<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow border-0 rounded-4">
        <div class="card-header bg-success text-white rounded-top-4">
          <h4 class="mb-0">ðŸ§¾ Review Your Order</h4>
        </div>
        <div class="card-body p-4">

          <table class="table align-middle text-center table-bordered">
            <thead class="table-light">
              <tr>
                <th>Product</th>
                <th>Variant</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="cart-body"></tbody>
          </table>

          <div class="text-end mt-3 mb-4">
            <p><strong>Shipping Fee:</strong> <span class="text-success">PKR 200</span></p>
            <h5><strong>Total:</strong> PKR <span id="grand-total" class="text-success fw-bold">0</span></h5>
          </div>

          <%= form_with url: buyer_orders_path, method: :post, local: true, id: "checkout-form" do %>
            <%= hidden_field_tag :cart_json, "", id: "cart-json" %>
            <%= submit_tag "Place Order", class: "btn btn-success w-100 py-2 fw-semibold shadow-sm rounded-pill" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const tbody = document.getElementById("cart-body");
    let subTotal = 0;

    cart.forEach(item => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.product_name || 'Product'}</td>
        <td>${(item.option_values || []).join(", ")}</td>
        <td>${item.quantity}</td>
        <td>PKR ${item.unit_price}</td>
        <td>PKR ${item.unit_price * item.quantity}</td>
      `;
      tbody.appendChild(row);
      subTotal += item.unit_price * item.quantity;
    });

    const shipping = 200;
    const grandTotal = subTotal + shipping;
    document.getElementById("grand-total").innerText = grandTotal;
    document.getElementById("cart-json").value = JSON.stringify(cart);
  });
</script>
