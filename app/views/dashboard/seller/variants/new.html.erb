<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-9">
      <div class="card shadow border-0">
        <div class="card-header bg-success text-white">
          <h4 class="mb-0">Generate Variants for "<%= @product.name %>"</h4>
        </div>

        <div class="card-body">
          <% if notice %>
            <div class="alert alert-success"><%= notice %></div>
          <% end %>

          <% if alert %>
            <div class="alert alert-danger"><%= alert %></div>
          <% end %>

          <% unassigned_option_types = OptionType.all - @product.option_types %>

          
          <h5 class="text-success">Assign Option Types</h5>
          <% if @product.option_types.any? %>
            <ul class="list-group mb-3">
              <% @product.option_types.each do |option_type| %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <%= option_type.name %>
                  <%= link_to "Remove",
                      dashboard_seller_product_product_option_type_path(@product, ProductOptionType.find_by(product: @product, option_type: option_type)),
                      method: :delete,
                      data: { confirm: "Remove this option type from product?" },
                      class: "btn btn-sm btn-outline-danger" %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">No option types assigned to this product yet.</p>
          <% end %>

          
          <%= form_with url: dashboard_seller_product_product_option_types_path(@product), method: :post, data: { turbo: false }, local: true, class: "row g-3 align-items-end mb-4" do %>
            <div class="col-md-6">
              <%= label_tag :option_type_id, "Add Option Type", class: "form-label" %>
              <%= select_tag :option_type_id,
                    options_from_collection_for_select(unassigned_option_types, :id, :name),
                    prompt: "Choose Option Type...", class: "form-select" %>
            </div>
            <div class="col-md-auto">
              <%= submit_tag "Add", class: "btn btn-success" %>
            </div>
          <% end %>

          <hr>

          
          <h5 class="text-success mb-3">Create Variant</h5>
          <%= form_with model: [@product, @variant], url: dashboard_seller_product_variants_path(@product), data: { turbo: false }, local: true do |form| %>

            <% if @variant.errors.any? %>
              <div class="alert alert-danger">
                <ul>
                  <% @variant.errors.full_messages.each do |msg| %>
                    <li><%= msg %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="mb-3">
              <%= form.label :sku, class: "form-label" %>
              <%= form.text_field :sku, class: "form-control", placeholder: "Enter SKU" %>
            </div>

            <div class="mb-3">
              <%= form.label :price, class: "form-label" %>
              <%= form.number_field :price, step: 0.01, class: "form-control", placeholder: "Enter price" %>
            </div>

            <div class="mb-3">
              <%= form.label :stock_quantity, class: "form-label" %>
              <%= form.number_field :stock_quantity, class: "form-control", placeholder: "Enter stock quantity" %>
            </div>

            <% @product.option_types.each do |option_type| %>
              <div class="mb-3">
                <%= label_tag "option_value_ids_#{option_type.id}", option_type.name, class: "form-label" %>
                <%= select_tag "option_value_ids[#{option_type.id}]",
                      options_from_collection_for_select(option_type.option_values, :id, :value),
                      include_blank: "Select #{option_type.name}",
                      class: "form-select" %>
              </div>
            <% end %>

            <div class="d-grid">
              <%= form.submit "Create Variant", class: "btn btn-success btn-lg" %>
            </div>
          <% end %>
        </div>

        <div class="card-footer bg-light text-end">
          <%= link_to "Back to Variants", dashboard_seller_product_variants_path(@product), class: "btn btn-outline-success" %>
        </div>
      </div>
    </div>
  </div>
</div>
