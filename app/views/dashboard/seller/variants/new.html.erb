<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-9">
      <div class="card shadow border-0">
        <div class="card-header bg-success text-white">
          <h4 class="mb-0">Generate Variants for "<%= @product.name %>"</h4>
        </div>

        <div class="card-body">
          <% if notice %>
            <div class="alert alert-success"><%= notice %></div>
          <% end %>
          <% if alert %>
            <div class="alert alert-danger"><%= alert %></div>
          <% end %>

          <% unassigned_option_types = OptionType.all - @product.option_types %>

          <h5 class="text-success">Assigned Option Types</h5>
          <% if @product.option_types.any? %>
            <ul class="list-group mb-3">
              <% @product.option_types.each do |option_type| %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <%= option_type.name %>
                  <%= link_to "Remove",
                      dashboard_seller_product_product_option_type_path(@product, ProductOptionType.find_by(product: @product, option_type: option_type)),
                      method: :delete,
                      data: { confirm: "Remove this option type from product?" },
                      class: "btn btn-sm btn-outline-danger" %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">No option types assigned to this product yet.</p>
          <% end %>

          <%= form_with url: dashboard_seller_product_product_option_types_path(@product), method: :post, data: { turbo: false }, local: true, class: "row g-3 align-items-end mb-4" do %>
            <div class="col-md-6">
              <%= label_tag :option_type_id, "Add Option Type", class: "form-label" %>
              <%= select_tag :option_type_id,
                    options_from_collection_for_select(unassigned_option_types, :id, :name),
                    prompt: "Choose Option Type...", class: "form-select" %>
            </div>
            <div class="col-md-auto">
              <%= submit_tag "Add", class: "btn btn-success" %>
            </div>
          <% end %>

          <% if @product.option_types.any? %>
            <hr>
            <%= form_with url: dashboard_seller_product_variants_path(@product), method: :post, data: { turbo: false }, local: true do %>
              <% @product.option_types.each do |option_type| %>
                <div class="mb-3">
                  <label class="form-label text-success"><%= option_type.name %> Values</label>
                  <div class="row">
                    <% option_type.option_values.each do |value| %>
                      <div class="col-md-4">
                        <div class="form-check">
                          <%= check_box_tag "option_value_ids[#{option_type.id}][]", value.id, false, class: "form-check-input", id: "ov_#{option_type.id}_#{value.id}" %>
                          <%= label_tag "ov_#{option_type.id}_#{value.id}", value.value, class: "form-check-label" %>
                        </div>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>

              <div class="d-grid mt-4">
                <%= submit_tag "Generate Variants", class: "btn btn-success btn-lg" %>
              </div>
            <% end %>
          <% end %>
        </div>

        <div class="card-footer bg-light text-end">
          <%= link_to "Back to Variants", dashboard_seller_product_variants_path(@product), class: "btn btn-outline-success" %>
        </div>
      </div>
    </div>
  </div>
</div>
